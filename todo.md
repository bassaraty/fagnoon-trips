# Fagnoon Trips Project Completion and Polish

- [ ] Analyze and break down user requirements.
- [ ] **Authorization & Policies**
    - [X] Enable and register Spatieâ€™s `role:admin` middleware on all `/api/admin/*` routes.
    - [X] Create and register Laravel Policy classes for Reservation and Birthday models.
    - [X] Enforce owner/admin access in Reservation and Birthday policies.
    - [X] Apply Reservation and Birthday policies in respective controllers.
    - [X] Enforce parent event owner/admin access for Attendee, Payment, and Feedback controllers.
- [ ] **Mass Assignment & Model Consistency**
    - [X] Define `$fillable` or `$guarded` in all Eloquent models (Reservation, Birthday, Location, Package, Activity, Attendee, Payment, Feedback, Notification).
    - [X] Rename/refactor `TripController` and routes to `ReservationController` and `reservations`.
    - [X] Update route definitions to `Route::apiResource('reservations', ReservationController::class)`.
- [ ] **Database Integrity & Constraints**
    - [X] Add composite unique index for `(location_id, reservation_date)` in reservations migration.
    - [X] Add composite unique index for `(location_id, event_date)` in birthdays migration.
    - [X] Remove unused migrations/tables (trips, customers, invoices, settings, activity_log, sessions).
- [ ] **Notification Logic Cleanup**
    - [X] Choose one notification mechanism (Observer or Service calls).
    - [X] Remove duplicated notification logic.
    - [X] Ensure notifications fire exactly once for create/update/delete events.
- [ ] **Investigate and Cleanup Project File Size**
    - [X] Analyze project disk usage.
    - [X] Explain size breakdown to user.
    - [ ] Remove unnecessary large directories (e.g., vendor, node_modules) if confirmed by user.
- [ ] **API Usability & Polymorphic Types**
    - [ ] Refactor endpoints to accept simple strings for polymorphic types (`eventable_type`, `payable_type`).
    - [ ] Internally map simple strings to correct model classes.
    - [ ] Update validation rules and controller logic for polymorphic types.
- [ ] **Front-End Wiring**
    - [ ] Implement UI and API for uploading payment slips.
    - [ ] Implement UI and API for uploading feedback images.
    - [ ] Implement notification panel (unread count, list, mark as read).
    - [ ] Implement branch filtering for locations and events.
    - [ ] Implement admin CRUD pages for packages, locations, activities, and users.
    - [ ] Implement calendar widget with event drill-down.
    - [ ] Implement dashboard cards for upcoming events.
- [ ] **Clean-Up & Documentation**
    - [ ] Remove commented-out code and obsolete TODOs.
    - [ ] Update `README.md` (roles setup, API usage, front-end build/run).
- [ ] **Testing**
    - [ ] Add PHPUnit feature test for booking (free vs. conflicting).
    - [ ] Add PHPUnit feature test for unauthorized access to another user's reservation.
    - [ ] Add PHPUnit feature test for file upload validation.
    - [ ] Add PHPUnit feature test for admin-only routes (non-admin vs. admin).
- [ ] Validate functionality and commit changes.
- [ ] Report completion and provide updated codebase.
